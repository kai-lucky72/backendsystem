2025-08-04 08:09:51.443 +02:00 [INF] No migrations were found in assembly 'backend'. A migration needs to be added before the database can be updated.
2025-08-04 08:09:51.873 +02:00 [INF] Executed DbCommand (27ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-04 08:09:51.890 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-08-04 08:09:51.960 +02:00 [INF] Executed DbCommand (67ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-08-04 08:09:52.177 +02:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-08-04 08:09:52.198 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-04 08:09:52.205 +02:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-08-04 08:09:52.259 +02:00 [INF] Executed DbCommand (43ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-08-04 08:09:52.278 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-08-04 08:09:52.293 +02:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-08-04 08:09:52.358 +02:00 [INF] User profile is available. Using 'C:\Users\Lamelo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-04 08:09:52.479 +02:00 [INF] Now listening on: http://localhost:5238
2025-08-04 08:09:52.483 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-04 08:09:52.485 +02:00 [INF] Hosting environment: Development
2025-08-04 08:09:52.487 +02:00 [INF] Content root path: C:\Users\Lamelo\RiderProject\backend\backend
2025-08-04 08:10:29.684 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5238/swagger/index.html - null null
2025-08-04 08:10:29.786 +02:00 [WRN] Failed to determine the https port for redirect.
2025-08-04 08:10:30.036 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5238/swagger/index.html - 200 null text/html;charset=utf-8 358.144ms
2025-08-04 08:10:30.309 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5238/swagger/index.js - null null
2025-08-04 08:10:30.333 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5238/swagger/index.js - 200 null application/javascript;charset=utf-8 23.9368ms
2025-08-04 08:10:30.353 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5238/swagger/swagger-ui-standalone-preset.js - null null
2025-08-04 08:10:30.365 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5238/swagger/swagger-ui-bundle.js - null null
2025-08-04 08:10:30.395 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5238/swagger/index.js - null null
2025-08-04 08:10:30.400 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5238/swagger/index.js - 200 null application/javascript;charset=utf-8 5.2797ms
2025-08-04 08:10:30.452 +02:00 [INF] Sending file. Request path: '/swagger-ui-standalone-preset.js'. Physical path: 'N/A'
2025-08-04 08:10:30.464 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5238/swagger/swagger-ui-standalone-preset.js - 200 230007 text/javascript 111.0632ms
2025-08-04 08:10:30.473 +02:00 [INF] Sending file. Request path: '/swagger-ui-bundle.js'. Physical path: 'N/A'
2025-08-04 08:10:30.482 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5238/swagger/swagger-ui-bundle.js - 200 1426001 text/javascript 116.1816ms
2025-08-04 08:10:30.605 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5238/swagger/v1/swagger.json - null null
2025-08-04 08:10:31.033 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5238/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 428.1381ms
2025-08-04 09:33:10.862 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5238/auth/login - application/json 75
2025-08-04 09:33:10.949 +02:00 [INF] CORS policy execution successful.
2025-08-04 09:33:11.117 +02:00 [INF] Executing endpoint 'backend.Controllers.AuthController.LoginAlternativeRoute (backend)'
2025-08-04 09:33:11.213 +02:00 [INF] Route matched with {action = "LoginAlternativeRoute", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[backend.DTOs.Auth.AuthResponse]] LoginAlternativeRoute(backend.DTOs.Auth.AuthRequest) on controller backend.Controllers.AuthController (backend).
2025-08-04 09:33:11.324 +02:00 [INF] Executing action method backend.Controllers.AuthController.LoginAlternativeRoute (backend) - Validation state: "Valid"
2025-08-04 09:33:11.333 +02:00 [INF] LOGIN REQUEST RECEIVED - workId: ADM001, email: admin@example.com, role: ADMIN
2025-08-04 09:33:12.180 +02:00 [ERR] Failed executing DbCommand (69ms) [Parameters=[@__workId_0='?' (Size = 8)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[AccessFailedCount], [u].[Active], [u].[ConcurrencyStamp], [u].[created_at], [u].[Email], [u].[EmailConfirmed], [u].[first_name], [u].[last_login], [u].[last_name], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[national_id], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[password_hash], [u].[phone_number], [u].[PhoneNumberConfirmed], [u].[profile_image_url], [u].[Role], [u].[SecurityStamp], [u].[TwoFactorEnabled], [u].[UserName], [u].[work_id], [a].[user_id], [a].[agent_type], [a].[group_id], [a].[manager_id], [a].[Sector], [m].[user_id], [m].[created_by], [m].[department]
FROM [users] AS [u]
LEFT JOIN [agents] AS [a] ON [u].[Id] = [a].[user_id]
LEFT JOIN [managers] AS [m] ON [u].[Id] = [m].[user_id]
WHERE [u].[work_id] = @__workId_0
2025-08-04 09:33:12.239 +02:00 [ERR] An exception occurred while iterating over the results of a query for context type 'backend.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'AccessFailedCount'.
Invalid column name 'ConcurrencyStamp'.
Invalid column name 'EmailConfirmed'.
Invalid column name 'LockoutEnabled'.
Invalid column name 'LockoutEnd'.
Invalid column name 'NormalizedEmail'.
Invalid column name 'NormalizedUserName'.
Invalid column name 'PhoneNumberConfirmed'.
Invalid column name 'SecurityStamp'.
Invalid column name 'TwoFactorEnabled'.
Invalid column name 'UserName'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__195_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:17e48434-655e-4a42-a11a-53436e62caf7
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'AccessFailedCount'.
Invalid column name 'ConcurrencyStamp'.
Invalid column name 'EmailConfirmed'.
Invalid column name 'LockoutEnabled'.
Invalid column name 'LockoutEnd'.
Invalid column name 'NormalizedEmail'.
Invalid column name 'NormalizedUserName'.
Invalid column name 'PhoneNumberConfirmed'.
Invalid column name 'SecurityStamp'.
Invalid column name 'TwoFactorEnabled'.
Invalid column name 'UserName'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__195_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:17e48434-655e-4a42-a11a-53436e62caf7
Error Number:207,State:1,Class:16
2025-08-04 09:33:12.248 +02:00 [ERR] User not found with workId: ADM001
2025-08-04 09:33:12.259 +02:00 [INF] Executed action method backend.Controllers.AuthController.LoginAlternativeRoute (backend), returned result Microsoft.AspNetCore.Mvc.UnauthorizedResult in 924.4671ms.
2025-08-04 09:33:12.276 +02:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-08-04 09:33:12.323 +02:00 [INF] Executed action backend.Controllers.AuthController.LoginAlternativeRoute (backend) in 1102.718ms
2025-08-04 09:33:12.325 +02:00 [INF] Executed endpoint 'backend.Controllers.AuthController.LoginAlternativeRoute (backend)'
2025-08-04 09:33:12.337 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5238/auth/login - 401 null application/problem+json; charset=utf-8 1484.7645ms
2025-08-04 09:37:43.890 +02:00 [INF] Application is shutting down...
2025-08-04 09:51:45.728 +02:00 [INF] Executed DbCommand (65ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-04 09:51:45.905 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-08-04 09:51:46.101 +02:00 [INF] Executed DbCommand (178ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-08-04 09:51:46.485 +02:00 [INF] Executed DbCommand (40ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-08-04 09:51:46.546 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-04 09:51:46.560 +02:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-08-04 09:51:46.669 +02:00 [INF] Executed DbCommand (89ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-08-04 09:51:46.728 +02:00 [INF] Applying migration '20250804073838_InitialCreate'.
2025-08-04 09:51:47.069 +02:00 [INF] Executed DbCommand (146ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [AspNetRoles] (
    [Id] bigint NOT NULL IDENTITY,
    [Name] nvarchar(256) NULL,
    [NormalizedName] nvarchar(256) NULL,
    [ConcurrencyStamp] nvarchar(max) NULL,
    CONSTRAINT [PK_AspNetRoles] PRIMARY KEY ([Id])
);
2025-08-04 09:51:47.195 +02:00 [ERR] Failed executing DbCommand (95ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [users] (
    [Id] bigint NOT NULL IDENTITY,
    [first_name] nvarchar(10) NOT NULL,
    [last_name] nvarchar(10) NOT NULL,
    [phone_number] nvarchar(15) NULL,
    [national_id] nvarchar(10) NULL,
    [Email] nvarchar(256) NOT NULL,
    [password_hash] nvarchar(10) NULL,
    [work_id] nvarchar(8) NOT NULL,
    [Role] int NOT NULL,
    [profile_image_url] nvarchar(10) NULL,
    [last_login] datetime2 NULL,
    [created_at] datetime2 NULL,
    [Active] bit NOT NULL,
    [UserName] nvarchar(256) NULL,
    [NormalizedUserName] nvarchar(256) NULL,
    [NormalizedEmail] nvarchar(256) NULL,
    [EmailConfirmed] bit NOT NULL,
    [SecurityStamp] nvarchar(max) NULL,
    [ConcurrencyStamp] nvarchar(max) NULL,
    [PhoneNumberConfirmed] bit NOT NULL,
    [TwoFactorEnabled] bit NOT NULL,
    [LockoutEnd] datetimeoffset NULL,
    [LockoutEnabled] bit NOT NULL,
    [AccessFailedCount] int NOT NULL,
    CONSTRAINT [PK_users] PRIMARY KEY ([Id])
);
2025-08-04 09:55:08.605 +02:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-04 09:55:08.666 +02:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-08-04 09:55:08.678 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-08-04 10:27:32.700 +02:00 [INF] No migrations were found in assembly 'backend'. A migration needs to be added before the database can be updated.
2025-08-04 10:27:33.948 +02:00 [INF] Executed DbCommand (65ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-04 10:27:34.003 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-08-04 10:27:34.155 +02:00 [INF] Executed DbCommand (144ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-08-04 10:27:34.581 +02:00 [INF] Executed DbCommand (37ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-08-04 10:27:34.627 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-04 10:27:34.642 +02:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-08-04 10:27:34.744 +02:00 [INF] Executed DbCommand (87ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-08-04 10:27:34.780 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-08-04 10:27:34.808 +02:00 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-08-04 10:27:34.981 +02:00 [INF] User profile is available. Using 'C:\Users\Lamelo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-04 10:27:35.245 +02:00 [INF] Now listening on: http://localhost:5238
2025-08-04 10:27:35.251 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-04 10:27:35.256 +02:00 [INF] Hosting environment: Development
2025-08-04 10:27:35.259 +02:00 [INF] Content root path: C:\Users\Lamelo\RiderProject\backend\backend
2025-08-04 10:27:47.116 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5238/auth/login - application/json 75
2025-08-04 10:27:47.157 +02:00 [WRN] Failed to determine the https port for redirect.
2025-08-04 10:27:47.163 +02:00 [INF] CORS policy execution successful.
2025-08-04 10:27:47.248 +02:00 [INF] Executing endpoint 'backend.Controllers.AuthController.LoginAlternativeRoute (backend)'
2025-08-04 10:27:47.278 +02:00 [INF] Route matched with {action = "LoginAlternativeRoute", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[backend.DTOs.Auth.AuthResponse]] LoginAlternativeRoute(backend.DTOs.Auth.AuthRequest) on controller backend.Controllers.AuthController (backend).
2025-08-04 10:27:47.350 +02:00 [INF] Executing action method backend.Controllers.AuthController.LoginAlternativeRoute (backend) - Validation state: "Valid"
2025-08-04 10:27:47.358 +02:00 [INF] LOGIN REQUEST RECEIVED - workId: ADM001, email: admin@example.com, role: ADMIN
2025-08-04 10:27:48.060 +02:00 [ERR] Failed executing DbCommand (76ms) [Parameters=[@__workId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[AccessFailedCount], [u].[Active], [u].[ConcurrencyStamp], [u].[created_at], [u].[Email], [u].[EmailConfirmed], [u].[first_name], [u].[last_login], [u].[last_name], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[national_id], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[password_hash], [u].[phone_number], [u].[PhoneNumberConfirmed], [u].[profile_image_url], [u].[Role], [u].[SecurityStamp], [u].[TwoFactorEnabled], [u].[UserName], [u].[work_id], [a].[user_id], [a].[agent_type], [a].[group_id], [a].[manager_id], [a].[Sector], [m].[user_id], [m].[created_by], [m].[department]
FROM [users] AS [u]
LEFT JOIN [agents] AS [a] ON [u].[Id] = [a].[user_id]
LEFT JOIN [managers] AS [m] ON [u].[Id] = [m].[user_id]
WHERE [u].[work_id] = @__workId_0
2025-08-04 10:27:48.109 +02:00 [ERR] An exception occurred while iterating over the results of a query for context type 'backend.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'AccessFailedCount'.
Invalid column name 'ConcurrencyStamp'.
Invalid column name 'EmailConfirmed'.
Invalid column name 'LockoutEnabled'.
Invalid column name 'LockoutEnd'.
Invalid column name 'NormalizedEmail'.
Invalid column name 'NormalizedUserName'.
Invalid column name 'PhoneNumberConfirmed'.
Invalid column name 'SecurityStamp'.
Invalid column name 'TwoFactorEnabled'.
Invalid column name 'UserName'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__195_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:f0af401a-ad72-4ce3-8da3-5bc752571709
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'AccessFailedCount'.
Invalid column name 'ConcurrencyStamp'.
Invalid column name 'EmailConfirmed'.
Invalid column name 'LockoutEnabled'.
Invalid column name 'LockoutEnd'.
Invalid column name 'NormalizedEmail'.
Invalid column name 'NormalizedUserName'.
Invalid column name 'PhoneNumberConfirmed'.
Invalid column name 'SecurityStamp'.
Invalid column name 'TwoFactorEnabled'.
Invalid column name 'UserName'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__195_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:f0af401a-ad72-4ce3-8da3-5bc752571709
Error Number:207,State:1,Class:16
2025-08-04 10:27:48.123 +02:00 [ERR] User not found with workId: ADM001
2025-08-04 10:27:48.133 +02:00 [INF] Executed action method backend.Controllers.AuthController.LoginAlternativeRoute (backend), returned result Microsoft.AspNetCore.Mvc.UnauthorizedResult in 773.9096ms.
2025-08-04 10:27:48.157 +02:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-08-04 10:27:48.218 +02:00 [INF] Executed action backend.Controllers.AuthController.LoginAlternativeRoute (backend) in 929.4207ms
2025-08-04 10:27:48.222 +02:00 [INF] Executed endpoint 'backend.Controllers.AuthController.LoginAlternativeRoute (backend)'
2025-08-04 10:27:48.242 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5238/auth/login - 401 null application/problem+json; charset=utf-8 1126.6489ms
2025-08-04 10:33:28.531 +02:00 [INF] Application is shutting down...
2025-08-04 11:34:01.940 +02:00 [INF] No migrations were found in assembly 'backend'. A migration needs to be added before the database can be updated.
2025-08-04 11:34:02.622 +02:00 [INF] Executed DbCommand (35ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-04 11:34:02.648 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-08-04 11:34:02.753 +02:00 [INF] Executed DbCommand (96ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-08-04 11:34:02.986 +02:00 [INF] Executed DbCommand (34ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-08-04 11:34:03.019 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-04 11:34:03.031 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-08-04 11:34:03.112 +02:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-08-04 11:34:03.135 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-08-04 11:34:03.170 +02:00 [INF] Executed DbCommand (29ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-08-04 11:34:03.279 +02:00 [INF] User profile is available. Using 'C:\Users\Lamelo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-04 11:34:03.496 +02:00 [INF] Now listening on: http://localhost:5238
2025-08-04 11:34:03.504 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-04 11:34:03.508 +02:00 [INF] Hosting environment: Development
2025-08-04 11:34:03.516 +02:00 [INF] Content root path: C:\Users\Lamelo\RiderProject\backend\backend
2025-08-04 11:34:19.907 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5238/auth/login - application/json 75
2025-08-04 11:34:20.006 +02:00 [WRN] Failed to determine the https port for redirect.
2025-08-04 11:34:20.017 +02:00 [INF] CORS policy execution successful.
2025-08-04 11:34:20.172 +02:00 [INF] Executing endpoint 'backend.Controllers.AuthController.LoginAlternativeRoute (backend)'
2025-08-04 11:34:20.249 +02:00 [INF] Route matched with {action = "LoginAlternativeRoute", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[backend.DTOs.Auth.AuthResponse]] LoginAlternativeRoute(backend.DTOs.Auth.AuthRequest) on controller backend.Controllers.AuthController (backend).
2025-08-04 11:34:20.423 +02:00 [INF] Executing action method backend.Controllers.AuthController.LoginAlternativeRoute (backend) - Validation state: "Valid"
2025-08-04 11:34:20.433 +02:00 [INF] LOGIN REQUEST RECEIVED - workId: ADM001, email: admin@example.com, role: ADMIN
2025-08-04 11:34:21.922 +02:00 [INF] Executed DbCommand (182ms) [Parameters=[@__workId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[active], [u].[created_at], [u].[email], [u].[first_name], [u].[last_login], [u].[last_name], [u].[national_id], [u].[password_hash], [u].[phone_number], [u].[profile_image_url], [u].[role], [u].[work_id], [a].[user_id], [a].[agent_type], [a].[group_id], [a].[manager_id], [a].[Sector], [m].[user_id], [m].[created_by], [m].[department]
FROM [users] AS [u]
LEFT JOIN [agents] AS [a] ON [u].[Id] = [a].[user_id]
LEFT JOIN [managers] AS [m] ON [u].[Id] = [m].[user_id]
WHERE [u].[work_id] = @__workId_0
2025-08-04 11:34:22.029 +02:00 [ERR] An exception occurred while iterating over the results of a query for context type 'backend.Data.ApplicationDbContext'.
System.InvalidCastException: Unable to cast object of type 'System.String' to type 'System.Int32'.
   at Microsoft.Data.SqlClient.SqlBuffer.get_Int32()
   at Microsoft.Data.SqlClient.SqlDataReader.GetInt32(Int32 i)
   at lambda_method69(Closure, QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
System.InvalidCastException: Unable to cast object of type 'System.String' to type 'System.Int32'.
   at Microsoft.Data.SqlClient.SqlBuffer.get_Int32()
   at Microsoft.Data.SqlClient.SqlDataReader.GetInt32(Int32 i)
   at lambda_method69(Closure, QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
2025-08-04 11:34:22.114 +02:00 [ERR] User not found with workId: ADM001
2025-08-04 11:34:22.148 +02:00 [INF] Executed action method backend.Controllers.AuthController.LoginAlternativeRoute (backend), returned result Microsoft.AspNetCore.Mvc.UnauthorizedResult in 1698.0149ms.
2025-08-04 11:34:22.326 +02:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-08-04 11:34:22.781 +02:00 [INF] Executed action backend.Controllers.AuthController.LoginAlternativeRoute (backend) in 2470.6417ms
2025-08-04 11:34:22.878 +02:00 [INF] Executed endpoint 'backend.Controllers.AuthController.LoginAlternativeRoute (backend)'
2025-08-04 11:34:22.968 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5238/auth/login - 401 null application/problem+json; charset=utf-8 3064.7111ms
2025-08-04 11:48:57.539 +02:00 [INF] Application is shutting down...
2025-08-04 11:49:19.128 +02:00 [INF] No migrations were found in assembly 'backend'. A migration needs to be added before the database can be updated.
2025-08-04 11:49:20.382 +02:00 [INF] Executed DbCommand (138ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-04 11:49:20.440 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-08-04 11:49:20.677 +02:00 [INF] Executed DbCommand (225ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-08-04 11:49:21.182 +02:00 [INF] Executed DbCommand (42ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-08-04 11:49:21.229 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-08-04 11:49:21.243 +02:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-08-04 11:49:21.338 +02:00 [INF] Executed DbCommand (82ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-08-04 11:49:21.358 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-08-04 11:49:21.408 +02:00 [INF] Executed DbCommand (44ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-08-04 11:49:21.606 +02:00 [INF] User profile is available. Using 'C:\Users\Lamelo\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-04 11:49:22.182 +02:00 [INF] Now listening on: http://localhost:5238
2025-08-04 11:49:22.190 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-04 11:49:22.193 +02:00 [INF] Hosting environment: Development
2025-08-04 11:49:22.196 +02:00 [INF] Content root path: C:\Users\Lamelo\RiderProject\backend\backend
2025-08-04 11:49:31.669 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5238/auth/login - application/json 75
2025-08-04 11:49:31.750 +02:00 [WRN] Failed to determine the https port for redirect.
2025-08-04 11:49:31.759 +02:00 [INF] CORS policy execution successful.
2025-08-04 11:49:31.874 +02:00 [INF] Executing endpoint 'backend.Controllers.AuthController.LoginAlternativeRoute (backend)'
2025-08-04 11:49:31.995 +02:00 [INF] Route matched with {action = "LoginAlternativeRoute", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[backend.DTOs.Auth.AuthResponse]] LoginAlternativeRoute(backend.DTOs.Auth.AuthRequest) on controller backend.Controllers.AuthController (backend).
2025-08-04 11:49:32.179 +02:00 [INF] Executing action method backend.Controllers.AuthController.LoginAlternativeRoute (backend) - Validation state: "Valid"
2025-08-04 11:49:32.188 +02:00 [INF] LOGIN REQUEST RECEIVED - workId: ADM001, email: admin@example.com, role: ADMIN
2025-08-04 11:49:33.174 +02:00 [INF] Executed DbCommand (151ms) [Parameters=[@__workId_0='?' (Size = 50) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[active], [u].[created_at], [u].[email], [u].[first_name], [u].[last_login], [u].[last_name], [u].[national_id], [u].[password_hash], [u].[phone_number], [u].[profile_image_url], [u].[role], [u].[work_id]
FROM [users] AS [u]
WHERE [u].[work_id] = @__workId_0
2025-08-04 11:49:33.722 +02:00 [INF] Executed DbCommand (70ms) [Parameters=[@__p_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[user_id], [a].[agent_type], [a].[group_id], [a].[manager_id], [a].[Sector]
FROM [agents] AS [a]
WHERE [a].[user_id] = @__p_0
2025-08-04 11:49:33.760 +02:00 [INF] Executed DbCommand (12ms) [Parameters=[@__p_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[user_id], [m].[created_by], [m].[department]
FROM [managers] AS [m]
WHERE [m].[user_id] = @__p_0
2025-08-04 11:49:33.767 +02:00 [INF] Authentication successful for user: ADM001
2025-08-04 11:49:33.829 +02:00 [INF] Login successful for user: ADM001, returning token
2025-08-04 11:49:33.845 +02:00 [INF] Executed action method backend.Controllers.AuthController.LoginAlternativeRoute (backend), returned result Microsoft.AspNetCore.Mvc.OkObjectResult in 1653.6154ms.
2025-08-04 11:49:33.875 +02:00 [INF] Executing OkObjectResult, writing value of type 'backend.DTOs.Auth.AuthResponse'.
2025-08-04 11:49:33.910 +02:00 [INF] Executed action backend.Controllers.AuthController.LoginAlternativeRoute (backend) in 1900.8073ms
2025-08-04 11:49:33.915 +02:00 [INF] Executed endpoint 'backend.Controllers.AuthController.LoginAlternativeRoute (backend)'
2025-08-04 11:49:33.942 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5238/auth/login - 200 null application/json; charset=utf-8 2282.309ms
